
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mes Outils HTML</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }

    h1 {
      text-align: center;
    }

    #searchBar {
      display: block;
      margin: 0 auto 30px auto;
      padding: 10px;
      width: 80%;
      max-width: 400px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .category {
      margin-bottom: 30px;
    }

    .category h2 {
      color: #333;
      border-bottom: 2px solid #ccc;
      padding-bottom: 5px;
    }

    .tool-list {
      list-style: none;
      padding: 0;
    }

    .tool-list li {
      margin: 8px 0;
    }

    .tool-list a {
      text-decoration: none;
      color: #007BFF;
    }

    .tool-list a:hover {
      text-decoration: underline;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>

  <h1>Mes Outils HTML</h1>
  <input type="text" id="searchBar" placeholder="Rechercher un outil...">
  <div id="toolContainer"></div>

  <script src="/includes/header-loader.js" defer></script>

  <script>
    async function loadToolsFromCSV(url) {
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("Fichier CSV introuvable");
        const csvText = await response.text();

        const lines = csvText.trim().split('\n');
        const tools = lines.map(line => {
          const [name, category, path] = line.split(';').map(s => s.trim());
          return { name, category, path };
        });

        const categories = {};
        tools.forEach(tool => {
          if (!categories[tool.category]) {
            categories[tool.category] = [];
          }
          categories[tool.category].push(tool);
        });

        const container = document.getElementById('toolContainer');
        const sortedCategoryNames = Object.keys(categories).sort();

        sortedCategoryNames.forEach(categoryName => {
          const categoryDiv = document.createElement('div');
          categoryDiv.className = 'category';

          const h2 = document.createElement('h2');
          h2.textContent = categoryName;
          categoryDiv.appendChild(h2);

          const ul = document.createElement('ul');
          ul.className = 'tool-list';

          const sortedTools = categories[categoryName].sort((a, b) =>
            a.name.localeCompare(b.name)
          );

          sortedTools.forEach(tool => {
            const li = document.createElement('li');
            li.innerHTML = `<a href="${tool.path}">${tool.name}</a>`;
            ul.appendChild(li);
          });

          categoryDiv.appendChild(ul);
          container.appendChild(categoryDiv);
        });

        // Recherche
        const searchInput = document.getElementById('searchBar');
        searchInput.addEventListener('input', () => {
          const query = searchInput.value.toLowerCase();
          document.querySelectorAll('.category').forEach(categoryDiv => {
            let anyVisible = false;
            categoryDiv.querySelectorAll('li').forEach(li => {
              const text = li.textContent.toLowerCase();
              const match = text.includes(query);
              li.style.display = match ? '' : 'none';
              if (match) anyVisible = true;
            });
            categoryDiv.style.display = anyVisible ? '' : 'none';
          });
        });

      } catch (error) {
        console.error("Erreur de chargement :", error);
        document.getElementById('toolContainer').textContent = "Erreur de chargement du fichier tools.csv.";
      }
    }

    loadToolsFromCSV("/includes/tools.csv");
  </script>
</body>
</html>
