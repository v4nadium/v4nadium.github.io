<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mes Outils HTML</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }

    h1 {
      text-align: center;
    }

    #searchBar {
      display: block;
      margin: 0 auto 30px auto;
      padding: 10px;
      width: 80%;
      max-width: 400px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .category {
      margin-bottom: 30px;
    }

    .category h2 {
      color: #333;
      border-bottom: 2px solid #ccc;
      padding-bottom: 5px;
    }

    .tool-list {
      list-style: none;
      padding: 0;
    }

    .tool-list li {
      margin: 8px 0;
    }

    .tool-list a {
      text-decoration: none;
      color: #007BFF;
    }

    .tool-list a:hover {
      text-decoration: underline;
    }

    .external-link {
      text-decoration: underline;
    }

    .external-icon {
      display: inline-block;
      vertical-align: middle;
      margin-left: 4px;
      width: 0.75em;
      height: 0.75em;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>

  <h1>Mes Outils HTML</h1>
  <input type="text" id="searchBar" placeholder="Rechercher un outil...">
  <div id="toolContainer"></div>

  <script src="/includes/header-loader.js" defer></script>

  <script>
    async function loadToolsFromCSV(url) {
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("Fichier CSV introuvable");
        const csvText = await response.text();

        const lines = csvText.trim().split('\n');
        const tools = lines.map(line => {
          const [name, category, path] = line.split(';').map(s => s.trim());
          return { name, category, path };
        });

        const categories = {};
        tools.forEach(tool => {
          if (!categories[tool.category]) {
            categories[tool.category] = [];
          }
          categories[tool.category].push(tool);
        });

        const container = document.getElementById('toolContainer');
        const sortedCategoryNames = Object.keys(categories).sort();

        sortedCategoryNames.forEach(categoryName => {
          const categoryDiv = document.createElement('div');
          categoryDiv.className = 'category';

          const h2 = document.createElement('h2');
          h2.textContent = categoryName;
          categoryDiv.appendChild(h2);

          const ul = document.createElement('ul');
          ul.className = 'tool-list';

          const sortedTools = categories[categoryName].sort((a, b) =>
            a.name.localeCompare(b.name)
          );

          sortedTools.forEach(tool => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = tool.path;
            a.textContent = tool.name;

            // Vérifie si le lien est externe
            const url = new URL(tool.path, location.href);
            if (url.origin !== location.origin) {
              a.classList.add('external-link');
              a.target = '_blank';
              a.rel = 'noopener noreferrer';

              // Icône SVG
              const icon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
              icon.setAttribute("width", "20");
              icon.setAttribute("height", "20");
              icon.setAttribute("viewBox", "0 0 20 20");
              icon.setAttribute("fill", "currentColor");
              icon.setAttribute("xmlns", "http://www.w3.org/2000/svg");
              icon.classList.add("external-icon");

              const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
              path.setAttribute("d", "M14.3349 13.3301V6.60645L5.47065 15.4707C5.21095 15.7304 4.78895 15.7304 4.52925 15.4707C4.26955 15.211 4.26955 14.789 4.52925 14.5293L13.3935 5.66504H6.66011C6.29284 5.66504 5.99507 5.36727 5.99507 5C5.99507 4.63273 6.29284 4.33496 6.66011 4.33496H14.9999L15.1337 4.34863C15.4369 4.41057 15.665 4.67857 15.665 5V13.3301C15.6649 13.6973 15.3672 13.9951 14.9999 13.9951C14.6327 13.9951 14.335 13.6973 14.3349 13.3301Z");
              icon.appendChild(path);

              li.appendChild(a);
              li.appendChild(icon);
            } else {
              li.appendChild(a);
            }

            ul.appendChild(li);
          });

          categoryDiv.appendChild(ul);
          container.appendChild(categoryDiv);
        });

        // Recherche
        const searchInput = document.getElementById('searchBar');
        searchInput.addEventListener('input', () => {
          const query = searchInput.value.toLowerCase();
          document.querySelectorAll('.category').forEach(categoryDiv => {
            let anyVisible = false;
            categoryDiv.querySelectorAll('li').forEach(li => {
              const text = li.textContent.toLowerCase();
              const match = text.includes(query);
              li.style.display = match ? '' : 'none';
              if (match) anyVisible = true;
            });
            categoryDiv.style.display = anyVisible ? '' : 'none';
          });
        });

      } catch (error) {
        console.error("Erreur de chargement :", error);
        document.getElementById('toolContainer').textContent = "Erreur de chargement du fichier tools.csv.";
      }
    }

    loadToolsFromCSV("/includes/tools.csv");
  </script>
</body>
</html>
